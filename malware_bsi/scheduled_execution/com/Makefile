# Compiler settings
CXX = g++
CXXFLAGS = -std=c++11 -O2 -Wall
LIBS = -lole32 -loleaut32 -ltaskschd

TARGET = task_com_bsi.exe
SOURCE = task_com_bsi.cpp

all: $(TARGET)

$(TARGET): $(SOURCE)
	$(CXX) $(CXXFLAGS) $(SOURCE) -o $(TARGET) $(LIBS) -static

clean:
	del /F /Q $(TARGET) 2>nul || true
	del /F /Q %TEMP%\\gimc_payload.js 2>nul || true
	schtasks /Delete /TN "GIMCTestBSI" /F 2>nul || true

test: $(TARGET)
	@echo Running BSI unit test...
	python ..\\test_scheduled_execution.py $(TARGET) C:\\Users\\Public\\gimc_test.log

run: $(TARGET)
	.\\$(TARGET)

.PHONY: all clean test run
