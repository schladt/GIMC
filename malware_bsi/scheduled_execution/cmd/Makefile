# Compiler settings
CC = gcc
CFLAGS = -std=c11 -O2 -Wall
LIBS = 

TARGET = task_cmd_bsi.exe
SOURCE = task_cmd_bsi.c

all: $(TARGET)

$(TARGET): $(SOURCE)
	$(CC) $(CFLAGS) $(SOURCE) -o $(TARGET) $(LIBS) -static

clean:
	del /F /Q $(TARGET) 2>nul || true
	del /F /Q C:\Users\Public\gimc_payload.js 2>nul || true
	del /F /Q C:\Users\Public\gimc_test.log 2>nul || true
	schtasks /Delete /TN "GIMCTestBSI" /F 2>nul || true

test: $(TARGET)
	@echo Running BSI unit test...
	python ..\\test_scheduled_execution.py $(TARGET) C:\\Users\\Public\\gimc_test.log

run: $(TARGET)
	.\\$(TARGET)

.PHONY: all clean test run
